---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getBookshelfData } from '../lib/hardcover';
import BookCard from '../components/BookCard.astro';

const pageTitle: string = 'Bookshelf';
const bookshelf = await getBookshelfData();
const MAX_VISIBLE_READ = 6;
---

<BaseLayout pageTitle={pageTitle}>
  <section class="space-y-6">
    <header>
      <h1 class="my-4 text-4xl">{pageTitle}</h1>
      <p class="text-lg text-slate-700 dark:text-slate-300">
        A look at what I'm reading and what I've read, provided by <a href="https://hardcover.app/home" class="underline decoration-slate-300 underline-offset-4">Hardcover</a>.
      </p>
    </header>

    {bookshelf.error ? (
      <div class="rounded border border-amber-300 bg-amber-50 p-4 text-amber-900 dark:border-amber-500/60 dark:bg-amber-900/20 dark:text-amber-100">
        <p class="font-semibold">Hardcover data is unavailable right now.</p>
        <p class="text-sm">{bookshelf.error}</p>
      </div>
    ) : null}

    <div class="grid gap-10">
      <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Currently Reading</h2>
        {bookshelf.currentlyReading.length === 0 ? (
          <p class="text-slate-600 dark:text-slate-400">No current reads.</p>
        ) : (
          <ul class="grid gap-4 grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
            {bookshelf.currentlyReading.map((book) => (
              <BookCard book={book} />
            ))}
          </ul>
        )}
      </section>

      <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Read</h2>
        {bookshelf.read.length === 0 ? (
          <p class="text-slate-600 dark:text-slate-400">No completed reads.</p>
        ) : (
          <>
            <ul class="grid gap-4 grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
              {bookshelf.read.map((book, index) => (
                <BookCard book={book} className={index >= MAX_VISIBLE_READ ? 'hidden extra-read-book' : ''} />
              ))}
            </ul>
            {bookshelf.read.length > MAX_VISIBLE_READ && (
              <button
                type="button"
                class="text-sm underline text-gray-600 dark:text-gray-300 cursor-pointer hover:text-gray-800 dark:hover:text-gray-100"
                id="read-toggle"
              >
                show all
              </button>
            )}
          </>
        )}
      </section>
    </div>
  </section>
</BaseLayout>

<script>
  document.addEventListener("astro:page-load", () => {
    const toggleBtn = document.getElementById("read-toggle");
    if (!toggleBtn) return;
    
    let isExpanded = false;
    
    toggleBtn.addEventListener("click", () => {
      isExpanded = !isExpanded;
      const extraBooks = document.querySelectorAll(".extra-read-book");
      
      extraBooks.forEach(book => {
        book.classList.toggle("hidden", !isExpanded);
      });
      
      toggleBtn.textContent = isExpanded ? "show less" : "show all";
    });
  });
</script>
